import{d as S,f as T,j as M,k as L}from"./chunk-FTZJADZT.js";import{a as H,b as R}from"./chunk-4PILAPRA.js";import{a as E,f as D}from"./chunk-3TN6O5IR.js";import{Cb as y,Db as a,Eb as V,Ma as u,Nb as C,Ra as _,Xa as h,ab as v,gc as w,hb as f,jc as I,ka as l,la as c,nb as r,ob as s,qb as x,rb as k,sb as d,tb as m,ub as p,wa as g}from"./chunk-7QM3SHZA.js";function O(t,n){t&1&&(x(0),r(1,"p"),a(2,"Verifying your email, please wait\u2026"),s(),k())}function A(t,n){if(t&1){let e=d();r(0,"button",11),m("click",function(){l(e);let o=p(3);return c(o.openLogin())}),a(1,"Go to login"),s()}}function q(t,n){if(t&1){let e=d();r(0,"button",11),m("click",function(){l(e);let o=p(3);return c(o.goHome())}),a(1,"Close"),s()}}function P(t,n){if(t&1&&(r(0,"div")(1,"p",8),a(2,"Your email has been verified. You can now log in."),s(),r(3,"div",9),v(4,A,2,0,"button",10)(5,q,2,0,"ng-template",null,2,C),s()()),t&2){let e=y(6),i=p(2);u(4),f("ngIf",!i.isLoggedIn)("ngIfElse",e)}}function U(t,n){if(t&1){let e=d();r(0,"p",12),a(1),s(),r(2,"div",9)(3,"button",11),m("click",function(){l(e);let o=p(2);return c(o.goHome())}),a(4,"Go home"),s()()}if(t&2){let e=p(2);u(),V(e.errorMessage()||"Verification failed.")}}function j(t,n){if(t&1&&v(0,P,7,2,"div",7)(1,U,5,1,"ng-template",null,1,C),t&2){let e=y(2),i=p();f("ngIf",i.success())("ngIfElse",e)}}var B=class t{constructor(n,e,i,o){this.route=n;this.http=e;this.snack=i;this.router=o}loading=g(!0);success=g(!1);errorMessage=g(null);isLoggedIn=!1;ngOnInit(){document.body.classList.add("modal-open"),this.isLoggedIn=!!localStorage.getItem("token");let n=this.route.snapshot.queryParamMap.get("token")||this.readFromSearch()||this.readFromHash()||sessionStorage.getItem("verifyToken");if(!n){this.loading.set(!1),this.success.set(!1),this.errorMessage.set("Missing verification token.");return}this.http.post(`${D.apiUrl}/auth/verify-email`,{token:n}).subscribe({next:e=>{this.success.set(!0),this.snack.open(e?.message||"Email verified!","",{duration:3e3}),sessionStorage.removeItem("verifyToken")},error:e=>{let i=e?.error?.message||"Verification failed.";this.success.set(!1),this.errorMessage.set(i),this.snack.open(i,"",{duration:4e3})},complete:()=>this.loading.set(!1)})}ngOnDestroy(){document.body.classList.remove("modal-open")}readFromSearch(){return new URLSearchParams(window.location.search||"").get("token")}readFromHash(){let n=window.location.hash||"",e=n.indexOf("?");return e===-1?null:new URLSearchParams(n.substring(e)).get("token")}goHome(){document.body.classList.remove("modal-open"),sessionStorage.removeItem("verifyToken"),this.router.navigateByUrl("/")}openLogin(){if(this.isLoggedIn){this.goHome();return}document.body.classList.remove("modal-open"),this.router.navigateByUrl("/").then(()=>{window.dispatchEvent(new CustomEvent("openLogin"))})}static \u0275fac=function(e){return new(e||t)(_(S),_(E),_(M),_(T))};static \u0275cmp=h({type:t,selectors:[["app-verify"]],decls:9,vars:3,consts:[["resultTpl",""],["errorTpl",""],["closeBtn",""],["appAccessibleClick","","aria-hidden","true",1,"bb-backdrop",3,"accessibleClick"],["role","dialog","aria-modal","true","aria-labelledby","verify-title","appTrapFocus","",1,"bb-modal",3,"click","onEscape"],["appAccessibleClick","","aria-label","Close",1,"close-button",3,"accessibleClick"],["id","verify-title",2,"margin-top","0"],[4,"ngIf","ngIfElse"],[1,"success"],[1,"text-center",2,"margin-top","12px"],["type","button",3,"click",4,"ngIf","ngIfElse"],["type","button",3,"click"],[1,"error"]],template:function(e,i){if(e&1){let o=d();r(0,"div",3),m("accessibleClick",function(){return l(o),c(i.goHome())}),r(1,"div",4),m("click",function(F){return l(o),c(F.stopPropagation())}),r(2,"button",5),m("accessibleClick",function(){return l(o),c(i.goHome())}),a(3,"\xD7"),s(),r(4,"h4",6),a(5,"Email verification"),s(),v(6,O,3,0,"ng-container",7)(7,j,3,2,"ng-template",null,0,C),s()()}if(e&2){let o=y(8);u(),f("onEscape",i.goHome),u(5),f("ngIf",i.loading())("ngIfElse",o)}},dependencies:[I,w,L,H,R],encapsulation:2})};export{B as VerifyComponent};

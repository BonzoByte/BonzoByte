<div class="bb-backdrop" appAccessibleClick (accessibleClick)="close()" aria-hidden="true">
    <div class="bb-modal" appTrapFocus [onEscape]="close" (click)="$event.stopPropagation()"
         role="dialog" aria-modal="true" aria-labelledby="login-title">
        <button class="close-button" appAccessibleClick (accessibleClick)="close()" aria-label="Close">×</button>

        <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
            <h4 id="login-title">Login</h4>

            <!-- IDENTIFIER -->
            <div class="form-row">
                <label for="identifier">Email or Username:</label>
                <input id="identifier"
                       formControlName="identifier"
                       [class.invalid]="identifier?.invalid && (identifier?.touched || submitted)"
                       placeholder="Username or Email" />
                <p class="error" *ngIf="identifier?.hasError('required') && (identifier?.touched || submitted)">Obavezno</p>
            </div>

            <!-- PASSWORD -->
            <div class="form-row">
                <label for="password">Password:</label>
                <div class="password-wrapper">
                    <input [type]="showPassword ? 'text' : 'password'"
                           id="password"
                           formControlName="password"
                           placeholder="Password"
                           class="password-input"
                           [class.invalid]="password?.invalid && (password?.touched || submitted)" />
                    <button type="button" appAccessibleClick (accessibleClick)="togglePassword()" class="toggle-password" aria-label="Toggle password visibility">
                        <i class="bi" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                    </button>
                </div>
                <p class="error" *ngIf="password?.hasError('required') && (password?.touched || submitted)">Obavezno</p>
            </div>

            <!-- SUBMIT -->
            <div class="text-center" *ngIf="!showResend">
                <button type="submit" [disabled]="loginForm.invalid">Prijavi se</button>
            </div>
            <div class="oauth-inline">
                <span class="muted">or continue with</span>
                <button type="button" class="link-button" (click)="loginWithGoogle()">
                    <!-- ako nemaš brand ikone, ostavi samo tekst -->
                    Google
                </button>
                <span class="sep">·</span>
                <button type="button" class="link-button" (click)="loginWithFacebook()">
                    Facebook
                </button>
            </div>

            <!-- ERROR: pogrešna lozinka -->
            <div *ngIf="loginFailed" class="text-center">
                <p class="error">Wrong Password</p>
                <button type="button" class="link-button" appAccessibleClick (accessibleClick)="openForgotPasswordModal()">
                    Zaboravili ste lozinku?
                </button>
            </div>

            <!-- RESEND (ako je korisnik ne-verificiran) -->
            <div class="text-center" *ngIf="showResend">
                <button type="button" class="link-button" appAccessibleClick (accessibleClick)="resendVerification()">
                    Ponovno pošalji verifikacijski link
                </button>
            </div>

            <!-- MESSAGES -->
            <p class="success" *ngIf="successMessage">{{ successMessage }}</p>
            <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>

            <!-- REGISTER SUGGESTION -->
            <div *ngIf="!loginFailed && showRegisterSuggestion" class="text-center">
                <span>Nemate račun?</span>
                <button type="button" class="link-button" appAccessibleClick (accessibleClick)="switchToRegister()">Register</button>
            </div>

            <!-- RESET PASSWORD (ako koristiš) -->
            <app-reset-password *ngIf="showResetPasswordModal" (close)="onCloseResetModal()"></app-reset-password>
        </form>
    </div>
</div>
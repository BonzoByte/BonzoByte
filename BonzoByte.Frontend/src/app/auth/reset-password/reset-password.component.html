<div class="bb-backdrop" appAccessibleClick (accessibleClick)="goToLogin()" aria-hidden="true">
    <div class="bb-modal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="reset-title"
         appTrapFocus
         [onEscape]="goToLogin"
         (click)="$event.stopPropagation()">
        <button class="close-button" appAccessibleClick (accessibleClick)="goToLogin()" aria-label="Close">×</button>

        <h4 id="reset-title">Reset Password</h4>

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="form-row">
                <label for="password">New Password:</label>
                <div class="password-wrapper">
                    <input [type]="showPassword ? 'text' : 'password'"
                           id="password"
                           formControlName="password"
                           class="password-input"
                           placeholder="New password"
                           [class.invalid]="form.get('password')?.invalid && (form.get('password')?.touched || submitted)" />
                    <button type="button" class="toggle-password" appAccessibleClick (accessibleClick)="showPassword = !showPassword" aria-label="Toggle password visibility">
                        <i class="bi" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                    </button>
                </div>
                <p class="error" *ngIf="form.get('password')?.hasError('required') && (form.get('password')?.touched || submitted)">Obavezno</p>
            </div>

            <div class="form-row">
                <label for="confirm">Confirm Password:</label>
                <div class="password-wrapper">
                    <input [type]="showConfirm ? 'text' : 'password'"
                           id="confirm"
                           formControlName="confirm"
                           class="password-input"
                           placeholder="Confirm password"
                           [class.invalid]="(form.get('confirm')?.touched || submitted) && !!form.errors?.['passwordsMismatch']" />
                    <button type="button" class="toggle-password" appAccessibleClick (accessibleClick)="showConfirm = !showConfirm" aria-label="Toggle password visibility">
                        <i class="bi" [ngClass]="showConfirm ? 'bi-eye-slash' : 'bi-eye'"></i>
                    </button>
                </div>
                <p class="error" *ngIf="form.errors?.['passwordsMismatch'] && (form.touched || submitted)">Lozinke se ne podudaraju</p>
            </div>

            <div class="text-center">
                <button type="submit" [disabled]="form.invalid || loading">Resetiraj lozinku</button>
            </div>

            <p class="success" *ngIf="successMessage">{{ successMessage }}</p>
            <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>
        </form>

        <div class="text-center" *ngIf="successMessage">
            <button type="button" class="link-button" appAccessibleClick (accessibleClick)="goToLogin()">Go to login</button>
        </div>
    </div>
</div>
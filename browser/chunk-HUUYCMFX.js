import{f as c}from"./chunk-FTZJADZT.js";import{a as m,f as i}from"./chunk-3TN6O5IR.js";import{F as n,W as s,_ as h,da as l,k as o,n as a,r as u}from"./chunk-7QM3SHZA.js";function p(e){return{_id:e?._id??"",name:e?.name??"",email:e?.email??"",nickname:e?.nickname??"",avatarUrl:e?.avatarUrl??null,isAdmin:!!e?.isAdmin,isUser:!!e?.isUser,isVerified:!!e?.isVerified,provider:Array.isArray(e?.provider)?e.provider:[]}}var f=class e{constructor(t,r){this.http=t;this.router=r}_user$=new o(null);_auth$=new o(!1);user$=this._user$.asObservable();authStatus$=this._auth$.asObservable();initAuth(t=!1){if(!localStorage.getItem("token")){this.setUser(null),this.setAuthState(!1);return}this._user$.value&&!t||this.http.get(`${i.apiUrl}/auth/me`).pipe(s(U=>{this.setUser(p(U)),this.setAuthState(!0)}),n(()=>(this.logout(!0),a(null)))).subscribe()}login(t){return this.http.post(`${i.apiUrl}/auth/login`,t).pipe(s(r=>{localStorage.setItem("token",r.token),this.setUser(p(r.user)),this.setAuthState(!0)}))}logout(t=!1){this.http.post(`${i.apiUrl}/auth/logout`,{}).pipe(n(()=>a(null))).subscribe(),localStorage.removeItem("token"),this.setUser(null),this.setAuthState(!1),t||this.router.navigateByUrl("/")}resendVerificationEmail(t){return this.http.post(`${i.apiUrl}/auth/resend-verification`,{email:t})}sendResetPasswordEmail(t){return this.http.post(`${i.apiUrl}/auth/forgotPassword`,{email:t})}checkNicknameExists(t){return this.http.get(`${i.apiUrl}/auth/nickname-exists/${encodeURIComponent(t)}`)}updateUser(t){return this.http.patch(`${i.apiUrl}/users/updateUserProfile`,t).pipe(u(r=>r?.user??r),s(r=>this.setUser(p(r))))}setAuthState(t){this._auth$.next(t)}setUser(t){this._user$.next(t)}getUser(){return this._user$.value}loginWithGoogle(){window.location.href=`${i.apiUrl}/auth/google`}loginWithFacebook(){window.location.href=`${i.apiUrl}/auth/facebook`}static \u0275fac=function(r){return new(r||e)(l(m),l(c))};static \u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})};export{f as a};

import{b as pe,d as fe}from"./chunk-LHYENONR.js";import"./chunk-B3HH2VOI.js";import"./chunk-HUUYCMFX.js";import"./chunk-FTZJADZT.js";import{a as ue}from"./chunk-GTH4H3DD.js";import{a as oe,c as ce,e as me,g as de,k as H}from"./chunk-UL5CEDMN.js";import{a as he,b as ge}from"./chunk-4PILAPRA.js";import{a as se,f as _e}from"./chunk-3TN6O5IR.js";import{Ab as ae,Bb as re,Cb as G,Db as l,Eb as _,Fb as y,Gb as A,Hb as $,Ia as j,Ib as R,Ja as ee,Kb as x,La as te,Ma as o,Mb as D,Nb as K,Ra as L,Xa as O,_ as q,ab as v,da as Z,fc as B,gb as E,gc as w,hb as m,hc as F,ib as Y,ic as le,ja as J,jb as S,jc as P,ka as h,la as g,lb as V,nb as a,ob as r,pb as f,qb as k,r as X,ra as C,rb as N,sb as b,tb as d,ub as u,yb as ne,zb as ie}from"./chunk-7QM3SHZA.js";function De(s,t){if(s&1){let e=b();a(0,"label",18)(1,"input",19),R("ngModelChange",function(i){h(e);let c=u();return $(c.selectedDateOption,i)||(c.selectedDateOption=i),g(i)}),d("change",function(){h(e);let i=u();return g(i.onDateOptionChange())})("click",function(){let i=h(e).$implicit,c=u();return g(c.onForceOptionChange(i.value))}),r(),a(2,"span"),l(3),r()()}if(s&2){let e=t.$implicit,n=u();o(),m("value",e.value),A("ngModel",n.selectedDateOption),o(2),_(e.label)}}function Te(s,t){if(s&1){let e=b();a(0,"div",20)(1,"div",21)(2,"label",22),l(3,"From"),r(),a(4,"input",23),x(5,"date"),x(6,"date"),R("ngModelChange",function(i){h(e);let c=u();return $(c.customFromDate,i)||(c.customFromDate=i),g(i)}),r()(),a(7,"div",21)(8,"label",24),l(9,"To"),r(),a(10,"input",25),x(11,"date"),x(12,"date"),R("ngModelChange",function(i){h(e);let c=u();return $(c.customToDate,i)||(c.customToDate=i),g(i)}),r()()()}if(s&2){let e=u();o(4),A("ngModel",e.customFromDate),E("min",D(5,6,e.minDate,"yyyy-MM-dd"))("max",D(6,9,e.maxDate,"yyyy-MM-dd")),o(6),A("ngModel",e.customToDate),E("min",D(11,12,e.minDate,"yyyy-MM-dd"))("max",D(12,15,e.maxDate,"yyyy-MM-dd"))}}function Ce(s,t){if(s&1){let e=b();a(0,"label",26)(1,"input",27),d("change",function(){let i=h(e).$implicit,c=u();return g(c.toggleSurface(i._id))}),r(),a(2,"span"),l(3),r()()}if(s&2){let e=t.$implicit,n=u();o(),m("checked",n.selectedSurfaceIds.includes(e._id)),o(2),_(e.surface)}}function Se(s,t){if(s&1){let e=b();a(0,"label",26)(1,"input",27),d("change",function(){let i=h(e).$implicit,c=u();return g(c.toggleTournamentType(i._id))}),r(),a(2,"span"),l(3),r()()}if(s&2){let e=t.$implicit,n=u();o(),m("checked",n.selectedTournamentTypeIds.includes(e._id)),o(2),_(e.type)}}function Ie(s,t){if(s&1){let e=b();a(0,"label",26)(1,"input",27),d("change",function(){let i=h(e).$implicit,c=u();return g(c.toggleTournamentLevel(i._id))}),r(),a(2,"span"),l(3),r()()}if(s&2){let e=t.$implicit,n=u();o(),m("checked",n.selectedTournamentLevelIds.includes(e._id)),o(2),_(e.level)}}var W=class s{closed=new C;filterApplied=new C;resetFilter=new C;surfaceFilterChanged=new C;tournamentTypeFilterChanged=new C;tournamentLevelFilterChanged=new C;activeDateFilter="all";activeFromDate=null;activeToDate=null;activeSurfaceIds=[];activeTournamentTypeIds=[];activeTournamentLevelIds=[];minDate;maxDate;dateOptions=[{label:"All matches",value:"all"},{label:"Last year",value:"year"},{label:"Last month",value:"month"},{label:"Last week",value:"week"},{label:"Custom date range",value:"custom"}];surfaces=[{_id:1,surface:"Indoors"},{_id:2,surface:"Clay"},{_id:3,surface:"Grass"},{_id:4,surface:"Hard"}];tournamentTypes=[{_id:2,type:"ATP"},{_id:4,type:"WTA"}];tournamentLevels=[{_id:1,level:"> 50,000$"},{_id:2,level:"Cup"},{_id:3,level:"Qualifications"},{_id:4,level:"< 50,000$"}];SURFACE_BY_ID={1:"indoors",2:"clay",3:"grass",4:"hard"};TYPE_BY_ID={2:"ATP",4:"WTA"};LEVEL_BY_ID={1:"> 50,000$",2:"Cup",3:"Qualifications",4:"< 50,000$"};selectedDateOption="all";selectedSurfaceIds=[];selectedTournamentTypeIds=[];selectedTournamentLevelIds=[];customFromDate=null;customToDate=null;ngOnChanges(t){t.activeDateFilter&&(this.selectedDateOption=this.activeDateFilter),this.activeDateFilter==="custom"?(this.customFromDate=this.activeFromDate,this.customToDate=this.activeToDate):(this.customFromDate=null,this.customToDate=null),t.activeSurfaceIds&&(this.selectedSurfaceIds=[...this.activeSurfaceIds]),(!this.selectedSurfaceIds||this.selectedSurfaceIds.length===0)&&(this.selectedSurfaceIds=[1,2,3,4]),t.activeTournamentTypeIds&&(this.selectedTournamentTypeIds=[...this.activeTournamentTypeIds]),(!this.selectedTournamentTypeIds||this.selectedTournamentTypeIds.length===0)&&(this.selectedTournamentTypeIds=[2,4]),t.activeTournamentLevelIds&&(this.selectedTournamentLevelIds=[...this.activeTournamentLevelIds]),(!this.selectedTournamentLevelIds||this.selectedTournamentLevelIds.length===0)&&(this.selectedTournamentLevelIds=[1,2,3,4])}ngOnInit(){document.body.classList.add("modal-open")}ngOnDestroy(){document.body.classList.remove("modal-open")}onDateOptionChange(){this.selectedDateOption!=="custom"&&(this.customFromDate=null,this.customToDate=null)}onForceOptionChange(t){this.selectedDateOption===t&&this.onDateOptionChange()}calculateStartDate(t){let e=new Date;switch(t){case"year":e.setFullYear(e.getFullYear()-1);break;case"month":e.setMonth(e.getMonth()-1);break;case"week":e.setDate(e.getDate()-7);break;default:return null}return e.toISOString().split("T")[0]}close(){this.closed.emit()}fmt(t){if(!t)return null;let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}calcStartFromMax(t){if(!this.maxDate)return null;let e=new Date(this.maxDate),n=new Date(this.maxDate);switch(t){case"year":n.setFullYear(n.getFullYear()-1);break;case"month":n.setMonth(n.getMonth()-1);break;case"week":n.setDate(n.getDate()-7);break;default:return null}return this.fmt(n)}apply(){let t=null,e=null;this.selectedDateOption==="custom"?(this.customFromDate&&this.customToDate&&this.customFromDate>this.customToDate&&([this.customFromDate,this.customToDate]=[this.customToDate,this.customFromDate]),t=this.customFromDate||null,e=this.customToDate||null):this.selectedDateOption==="all"?(t=null,e=null):(t=this.calculateStartDate(this.selectedDateOption),e=new Date().toISOString().split("T")[0]);let n=this.selectedSurfaceIds.map(Number),i=this.selectedTournamentTypeIds.map(Number),c=this.selectedTournamentLevelIds.map(Number),p={option:this.selectedDateOption,startDate:t,endDate:e,surfaceIds:n,tournamentTypeIds:i,tournamentLevelIds:c};console.groupCollapsed("%c[Filter] Emitting","color:#0b5; font-weight:600;"),console.log("dateOption:",this.selectedDateOption,{startDate:t,endDate:e}),console.table([{key:"surfaceIds",values:n.join(", ")||"(empty)"},{key:"tournamentTypeIds",values:i.join(", ")||"(empty)"},{key:"tournamentLevelIds",values:c.join(", ")||"(empty)"}]),console.groupEnd(),this.filterApplied.emit(p)}toggleSurface(t){this.selectedSurfaceIds=this.selectedSurfaceIds.includes(t)?this.selectedSurfaceIds.filter(e=>e!==t):[...this.selectedSurfaceIds,t],console.log("[Filter] surfaceIds \u2192",this.selectedSurfaceIds)}toggleTournamentType(t){this.selectedTournamentTypeIds=this.selectedTournamentTypeIds.includes(t)?this.selectedTournamentTypeIds.filter(e=>e!==t):[...this.selectedTournamentTypeIds,t],console.log("[Filter] tournamentTypeIds \u2192",this.selectedTournamentTypeIds)}toggleTournamentLevel(t){this.selectedTournamentLevelIds=this.selectedTournamentLevelIds.includes(t)?this.selectedTournamentLevelIds.filter(e=>e!==t):[...this.selectedTournamentLevelIds,t],console.log("[Filter] tournamentLevelIds \u2192",this.selectedTournamentLevelIds)}reset(){this.selectedDateOption="all",this.customFromDate=null,this.customToDate=null,this.selectedSurfaceIds=[1,2,3,4],this.selectedTournamentTypeIds=[2,4],this.selectedTournamentLevelIds=[1,2,3,4],this.resetFilter.emit()}selectAllSurfaces(){this.selectedSurfaceIds=this.surfaces.map(t=>t._id)}clearSurfaces(){this.selectedSurfaceIds=[]}selectAllTypes(){this.selectedTournamentTypeIds=this.tournamentTypes.map(t=>t._id)}clearTypes(){this.selectedTournamentTypeIds=[]}selectAllLevels(){this.selectedTournamentLevelIds=this.tournamentLevels.map(t=>t._id)}clearLevels(){this.selectedTournamentLevelIds=[]}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=O({type:s,selectors:[["app-match-filter-modal"]],inputs:{activeDateFilter:"activeDateFilter",activeFromDate:"activeFromDate",activeToDate:"activeToDate",activeSurfaceIds:"activeSurfaceIds",activeTournamentTypeIds:"activeTournamentTypeIds",activeTournamentLevelIds:"activeTournamentLevelIds",minDate:"minDate",maxDate:"maxDate"},outputs:{closed:"closed",filterApplied:"filterApplied",resetFilter:"resetFilter",surfaceFilterChanged:"surfaceFilterChanged",tournamentTypeFilterChanged:"tournamentTypeFilterChanged",tournamentLevelFilterChanged:"tournamentLevelFilterChanged"},features:[J],decls:61,vars:6,consts:[["appAccessibleClick","","aria-hidden","true",1,"bb-backdrop",3,"accessibleClick"],["role","dialog","aria-modal","true","aria-labelledby","filter-title","appTrapFocus","",1,"bb-modal","filter-modal",2,"--bb-modal-maxw","720px",3,"click","onEscape"],["appAccessibleClick","","aria-label","Close",1,"close-button",3,"accessibleClick"],["id","filter-title",1,"text-center"],[1,"section"],[1,"section-title"],[1,"segmented-wrap"],["class","seg-item",4,"ngFor","ngForOf"],["class","grid-2",4,"ngIf"],[1,"hr"],[1,"title-actions"],[1,"link-button","small",3,"click"],[1,"sep"],[1,"chip-grid"],["class","chip",4,"ngFor","ngForOf"],[1,"chip-row"],[1,"actions"],[1,"link-button",3,"click"],[1,"seg-item"],["type","radio","name","dateFilter",3,"ngModelChange","change","click","value","ngModel"],[1,"grid-2"],[1,"field"],["for","fromDate"],["id","fromDate","type","date",3,"ngModelChange","ngModel"],["for","toDate"],["id","toDate","type","date",3,"ngModelChange","ngModel"],[1,"chip"],["type","checkbox",3,"change","checked"]],template:function(e,n){e&1&&(a(0,"div",0),d("accessibleClick",function(){return n.close()}),a(1,"div",1),d("click",function(c){return c.stopPropagation()}),a(2,"button",2),d("accessibleClick",function(){return n.close()}),l(3,"\xD7"),r(),a(4,"h4",3),l(5,"Filter Matches"),r(),a(6,"div",4)(7,"div",5)(8,"span"),l(9,"Filter by Date:"),r()(),a(10,"div",6),v(11,De,4,3,"label",7),r(),v(12,Te,13,18,"div",8),r(),f(13,"div",9),a(14,"div",4)(15,"div",5)(16,"span"),l(17,"Filter by Surface:"),r(),a(18,"div",10)(19,"button",11),d("click",function(){return n.selectAllSurfaces()}),l(20,"All"),r(),a(21,"span",12),l(22,"\xB7"),r(),a(23,"button",11),d("click",function(){return n.clearSurfaces()}),l(24,"None"),r()()(),a(25,"div",13),v(26,Ce,4,2,"label",14),r()(),f(27,"div",9),a(28,"div",4)(29,"div",5)(30,"span"),l(31,"Filter by Tournament Type:"),r(),a(32,"div",10)(33,"button",11),d("click",function(){return n.selectAllTypes()}),l(34,"All"),r(),a(35,"span",12),l(36,"\xB7"),r(),a(37,"button",11),d("click",function(){return n.clearTypes()}),l(38,"None"),r()()(),a(39,"div",15),v(40,Se,4,2,"label",14),r()(),f(41,"div",9),a(42,"div",4)(43,"div",5)(44,"span"),l(45,"Filter by Tournament Level:"),r(),a(46,"div",10)(47,"button",11),d("click",function(){return n.selectAllLevels()}),l(48,"All"),r(),a(49,"span",12),l(50,"\xB7"),r(),a(51,"button",11),d("click",function(){return n.clearLevels()}),l(52,"None"),r()()(),a(53,"div",13),v(54,Ie,4,2,"label",14),r()(),f(55,"div",9),a(56,"div",16)(57,"button",17),d("click",function(){return n.apply()}),l(58,"Apply"),r(),a(59,"button",17),d("click",function(){return n.reset()}),l(60,"Reset"),r()()()()),e&2&&(o(),m("onEscape",n.close),o(10),m("ngForOf",n.dateOptions),o(),m("ngIf",n.selectedDateOption==="custom"),o(14),m("ngForOf",n.surfaces),o(14),m("ngForOf",n.tournamentTypes),o(14),m("ngForOf",n.tournamentLevels))},dependencies:[P,B,w,F,H,oe,de,ce,me,he,ge],encapsulation:2})};function Oe(s,t){if(s&1&&(a(0,"a",30),l(1,"Download JSON"),r()),s&2){let e=t.ngIf;m("href",e,ee)}}function we(s,t){if(s&1&&(k(0),a(1,"div",31)(2,"div",32),l(3),r(),a(4,"div",33),l(5),r(),a(6,"div",34),l(7,"NN win probability"),r()(),N()),s&2){let e=t.ngIf;o(2),S("p1",e.who===1)("p2",e.who===2),o(),y("",e.probPct,"%"),o(2),_(e.name)}}function Fe(s,t){s&1&&(a(0,"div",35),l(1,"NN probability unavailable"),r())}function Pe(s,t){if(s&1&&(a(0,"div",36)(1,"div",37),f(2,"div",16)(3,"div",18),r(),a(4,"div",38)(5,"div",39)(6,"strong"),l(7),x(8,"number"),r(),l(9),r(),a(10,"div",40),l(11),a(12,"strong"),l(13),x(14,"number"),r()()()()),s&2){let e=t.ngIf,n=u(3);o(2),Y("width",e.p1*100,"%"),o(),Y("width",e.p2*100,"%"),o(4),y("",D(8,8,e.p1*100,"1.0-0"),"%"),o(2),y(" ",n.p1Name,""),o(2),y("",n.p2Name," "),o(2),y("",D(14,11,e.p2*100,"1.0-0"),"%")}}function Ee(s,t){if(s&1&&(k(0),l(1),N()),s&2){let e=u(4);o(),y(" \u2014 ",e.resultDetails,"")}}function ke(s,t){if(s&1&&(a(0,"div",24)(1,"span",25),l(2,"Result"),r(),a(3,"span",26),l(4),v(5,Ee,2,1,"ng-container",41),r()()),s&2){let e=u(3);o(4),_(e.result),o(),m("ngIf",e.resultDetails)}}function Ne(s,t){if(s&1&&(a(0,"div",24)(1,"span",25),l(2,"Odds"),r(),a(3,"span",42),l(4),r()()),s&2){let e=u(3);o(4),_(e.match.oddsText)}}function Le(s,t){if(s&1&&(k(0),l(1),N()),s&2){let e=u(4);o(),y(" for ",e.p1Name,"")}}function Ve(s,t){if(s&1&&(k(0),l(1),N()),s&2){let e=u(4);o(),y(" for ",e.p2Name,"")}}function Ae(s,t){if(s&1&&(a(0,"div",24)(1,"span",25),l(2,"TS \u03BC edge"),r(),a(3,"span",26),l(4),x(5,"number"),v(6,Le,2,1,"ng-container",41)(7,Ve,2,1,"ng-container",41),r()()),s&2){let e=t.ngIf;o(3),S("pos",e.delta>0)("neg",e.delta<0),o(),y(" ",D(5,7,e.delta,"1.0-1")," "),o(2),m("ngIf",e.who===1),o(),m("ngIf",e.who===2)}}function $e(s,t){if(s&1){let e=b();a(0,"section",13)(1,"header",14)(2,"div",15)(3,"span",16),l(4),r(),a(5,"span",17),l(6,"vs"),r(),a(7,"span",18),l(8),r()(),v(9,Oe,2,1,"a",19),r(),a(10,"div",20),v(11,we,8,6,"ng-container",21)(12,Fe,2,0,"ng-template",null,1,K)(14,Pe,15,14,"div",22),r(),a(15,"div",23)(16,"div",24)(17,"span",25),l(18,"Tournament"),r(),a(19,"span",26),l(20),r()(),a(21,"div",24)(22,"span",25),l(23,"Date"),r(),a(24,"span",26)(25,"time"),l(26),x(27,"date"),r()()(),a(28,"div",24)(29,"span",25),l(30,"Surface"),r(),a(31,"span",26),l(32),r()(),a(33,"div",24)(34,"span",25),l(35,"Status"),r(),a(36,"span",26),l(37),r()(),v(38,ke,6,2,"div",27)(39,Ne,5,1,"div",27)(40,Ae,8,10,"div",27),r(),a(41,"div",28)(42,"button",29),d("click",function(){h(e);let i=u(2);return g(i.activeTab="stats")}),l(43,"Stats"),r(),a(44,"button",29),d("click",function(){h(e);let i=u(2);return g(i.activeTab="ts")}),l(45,"TS"),r(),a(46,"button",29),d("click",function(){h(e);let i=u(2);return g(i.activeTab="wp")}),l(47,"Win Prob"),r()()()}if(s&2){let e=G(13),n=u(2);o(),ne("title","",n.p1Name," vs ",n.p2Name,""),o(3),_(n.p1Name),o(4),_(n.p2Name),o(),m("ngIf",n.downloadUrl),o(2),m("ngIf",n.favorite)("ngIfElse",e),o(3),m("ngIf",n.nn),o(6),_(n.tournamentName),o(5),E("datetime",n.dateTimeISO),o(),_(D(27,21,n.dateTimeISO,"medium")),o(6),_(n.surface||"\u2014"),o(4),S("ok",n.statusLabel==="Scheduled")("bad",n.statusLabel==="Finished"),o(),_(n.statusLabel),o(),m("ngIf",n.result),o(),m("ngIf",n.match==null?null:n.match.oddsText),o(),m("ngIf",n.tsEdge)}}function Re(s,t){s&1&&(a(0,"section",43)(1,"h3"),l(2,"Stats"),r(),a(3,"p"),l(4,"Performance, Set, Game, Expectation \u2014 coming next."),r()())}function Be(s,t){s&1&&(a(0,"section",43)(1,"h3"),l(2,"TrueSkill Breakdown"),r(),a(3,"p"),l(4,"Time-series chart with model/surface toggles \u2014 coming next."),r()())}function He(s,t){s&1&&(a(0,"section",43)(1,"h3"),l(2,"Win Probability Breakdown"),r(),a(3,"p"),l(4,"TS-derived WP timeline + NN chip \u2014 coming next."),r()())}function We(s,t){s&1&&(a(0,"section",43)(1,"h3"),l(2,"H2H"),r(),a(3,"p"),l(4,"Mini summary + surface splits \u2014 coming next."),r()())}function Ue(s,t){if(s&1&&(a(0,"div",10),v(1,$e,48,24,"section",11)(2,Re,5,0,"section",12)(3,Be,5,0,"section",12)(4,He,5,0,"section",12)(5,We,5,0,"section",12),r()),s&2){let e=u();o(),m("ngIf",e.activeTab==="summary"),o(),m("ngIf",e.activeTab==="stats"),o(),m("ngIf",e.activeTab==="ts"),o(),m("ngIf",e.activeTab==="wp"),o(),m("ngIf",e.activeTab==="h2h")}}function ze(s,t){s&1&&(a(0,"div",44),f(1,"div",45),a(2,"div"),l(3,"Loading match details\u2026"),r()())}var U=class s{match;loading=!1;flagBaseUrl="/assets/flags/";initialTab="summary";closed=new C;activeTab="summary";ngOnInit(){this.activeTab=this.initialTab??"summary"}close(){this.closed.emit()}get p1Name(){return this.match?.player1Label??this.match?.player1Name??"Player 1"}get p2Name(){return this.match?.player2Label??this.match?.player2Name??"Player 2"}get p1Seed(){return this.asTextOrNull(this.match?.player1Seed)}get p2Seed(){return this.asTextOrNull(this.match?.player2Seed)}get p1Flag(){return this.flagUrl(this.match?.player1CountryISO2)}get p2Flag(){return this.flagUrl(this.match?.player2CountryISO2)}get tournamentName(){return this.match?.tournamentEventName??""}get tournamentType(){return this.match?.tournamentTypeName??""}get roundName(){return this.match?.roundName??""}get surface(){return this.match?.matchSurfaceName||this.match?.tournamentEventSurfaceName||""}get countryISO2(){return this.match?.tournamentEventCountryISO2??""}get countryFull(){return this.match?.tournamentEventCountryFull??""}get isFinished(){return!!this.match?.isFinished||!!this.asTextOrNull(this.match?.result)}get dateTimeISO(){return this.match?.dateTime??this.match?.tournamentEventDate??""}get result(){return this.asTextOrNull(this.match?.result)}get resultDetails(){return this.asTextOrNull(this.match?.resultDetails)}get p1SetsWon(){return this.asNumberOrNull(this.match?.p1SetsWon)}get p2SetsWon(){return this.asNumberOrNull(this.match?.p2SetsWon)}get p1Nn(){return this.asNumberOrNull(this.match?.winProbabilityPlayer1NN)}get p2Nn(){return this.asNumberOrNull(this.match?.winProbabilityPlayer2NN)}get p1M(){return this.asNumberOrNull(this.match?.winProbabilityPlayer1M)}get p2M(){return this.asNumberOrNull(this.match?.winProbabilityPlayer2M)}get p1SM(){return this.asNumberOrNull(this.match?.winProbabilityPlayer1SM)}get p2SM(){return this.asNumberOrNull(this.match?.winProbabilityPlayer2SM)}get p1GSM(){return this.asNumberOrNull(this.match?.winProbabilityPlayer1GSM)}get p2GSM(){return this.asNumberOrNull(this.match?.winProbabilityPlayer2GSM)}get tsEdge(){let t=this.asNumberOrNull(this.match?.player1TrueSkillMeanM),e=this.asNumberOrNull(this.match?.player2TrueSkillMeanM);if(t==null||e==null)return null;let n=Me(t-e),i=n>0?1:n<0?2:0;return{delta:n,who:i}}getSurfaceAdjustedEdge(){let t=this.asNumberOrNull(this.match?.matchSurfaceId);if(!t)return null;let e=this.pick(this.match,`player1TrueSkillMeanGSMS${t}`),n=this.pick(this.match,`player2TrueSkillMeanGSMS${t}`);if(e==null||n==null)return null;let i=Me(e-n),c=i>0?1:i<0?2:0;return{delta:i,who:c}}get who2Bet(){let t=Number(this.match?.who2Bet??0);return t===1||t===2?t:0}get p1Streak(){return this.asNumberOrNull(this.match?.player1Streak)}get p2Streak(){return this.asNumberOrNull(this.match?.player2Streak)}get p1H2H(){return this.asNumberOrNull(this.match?.player1H2H)}get p2H2H(){return this.asNumberOrNull(this.match?.player2H2H)}get prize(){return this.asNumberOrNull(this.match?.prize)}get level(){return this.asTextOrNull(this.match?.tournamentLevelName)}get eventDateISO(){return this.asTextOrNull(this.match?.tournamentEventDate)}get nn(){let t=this.p1Nn,e=this.p2Nn;if(t==null||e==null){let n=this.asTextOrNull(this.match?.probabilityText);if(n){let i=this.parseProbPair(n);i&&(t=i.p1,e=i.p2)}}return t==null||e==null||((t>1.0001||e>1.0001)&&(t=t/100,e=e/100),!Number.isFinite(t)||!Number.isFinite(e))?null:{p1:t,p2:e}}get favorite(){let t=this.nn;return t?t.p1>=t.p2?{who:1,name:this.p1Name,probPct:Math.round(t.p1*100)}:{who:2,name:this.p2Name,probPct:Math.round(t.p2*100)}:null}get statusLabel(){if(this.isFinished)return"Finished";let t=Date.parse(this.dateTimeISO||"");return Number.isFinite(t)&&t>Date.now()?"Scheduled":"\u2014"}get chipSurface(){return this.surface||""}get chipLevel(){return this.level??""}get chipCountryIso2(){return this.countryISO2||""}get chipCountryFlagUrl(){return this.flagUrl(this.countryISO2)}get downloadUrl(){let t=this.pickId();return t?`/api/archives/match-details/${t}?download=1`:null}flagUrl(t){return t?`${this.flagBaseUrl}${String(t).toLowerCase()}.svg`:null}pick(t,e){let n=t?.[e];if(n==null)return null;let i=Number(n);return Number.isFinite(i)?i:null}asTextOrNull(t){if(t==null)return null;let e=String(t).trim();return e.length?e:null}asNumberOrNull(t){let e=Number(t);return Number.isFinite(e)?e:null}pickId(){let t=this.match,e=t?.matchTPId??t?.MatchTPId??t?.id??null,n=Number(e);return Number.isFinite(n)?n:null}parseProbPair(t){if(!t)return null;let n=t.replace(/[–—]/g,"-").split("-").map(M=>M.trim()).filter(Boolean);if(n.length!==2)return null;let i=M=>Number(String(M).replace(",",".")),c=i(n[0]),p=i(n[1]);return!Number.isFinite(c)||!Number.isFinite(p)?null:((c>1.0001||p>1.0001)&&(c=c/100,p=p/100),{p1:c,p2:p})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=O({type:s,selectors:[["app-match-details-modal"]],inputs:{match:"match",loading:"loading",flagBaseUrl:"flagBaseUrl",initialTab:"initialTab"},outputs:{closed:"closed"},decls:21,vars:12,consts:[["loadingTpl",""],["noProbTpl",""],[1,"mdc-overlay",3,"click"],["role","dialog","aria-modal","true","aria-labelledby","matchDetailsTitle",1,"mdc",3,"click"],[1,"mdc__header"],["id","matchDetailsTitle"],["type","button","aria-label","Close",1,"icon-btn",3,"click"],["aria-label","Match Details Tabs",1,"tabs"],[3,"click"],["class","mdc__body",4,"ngIf","ngIfElse"],[1,"mdc__body"],["class","summary clean",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"summary","clean"],[1,"s-title",3,"title"],[1,"line"],[1,"p1"],[1,"vs"],[1,"p2"],["target","_blank","rel","noopener","class","dl",3,"href",4,"ngIf"],[1,"punch"],[4,"ngIf","ngIfElse"],["class","bar-wrap",4,"ngIf"],[1,"facts"],[1,"f"],[1,"k"],[1,"v"],["class","f",4,"ngIf"],[1,"cta"],[1,"btn",3,"click"],["target","_blank","rel","noopener",1,"dl",3,"href"],[1,"fav"],[1,"pct"],[1,"who"],[1,"sub"],[1,"fav","muted"],[1,"bar-wrap"],["aria-label","Win probability",1,"bar"],[1,"bar-lbls"],[1,"side","p1"],[1,"side","p2"],[4,"ngIf"],[1,"v","mono"],[1,"placeholder"],[1,"loading"],["aria-hidden","true",1,"spinner"]],template:function(e,n){if(e&1){let i=b();a(0,"div",2),d("click",function(){return h(i),g(n.close())}),a(1,"div",3),d("click",function(p){return h(i),g(p.stopPropagation())}),a(2,"div",4)(3,"h2",5),l(4,"Match Details"),r(),a(5,"button",6),d("click",function(){return h(i),g(n.close())}),l(6,"\xD7"),r()(),a(7,"nav",7)(8,"button",8),d("click",function(){return h(i),g(n.activeTab="summary")}),l(9,"Summary"),r(),a(10,"button",8),d("click",function(){return h(i),g(n.activeTab="stats")}),l(11,"Stats"),r(),a(12,"button",8),d("click",function(){return h(i),g(n.activeTab="ts")}),l(13,"TS Breakdown"),r(),a(14,"button",8),d("click",function(){return h(i),g(n.activeTab="wp")}),l(15,"Win Probability"),r(),a(16,"button",8),d("click",function(){return h(i),g(n.activeTab="h2h")}),l(17,"H2H"),r()(),v(18,Ue,6,5,"div",9)(19,ze,4,0,"ng-template",null,0,K),r()()}if(e&2){let i=G(20);o(8),S("active",n.activeTab==="summary"),o(2),S("active",n.activeTab==="stats"),o(2),S("active",n.activeTab==="ts"),o(2),S("active",n.activeTab==="wp"),o(2),S("active",n.activeTab==="h2h"),o(2),m("ngIf",!n.loading)("ngIfElse",i)}},dependencies:[P,w,le,F],styles:['@charset "UTF-8";[_nghost-%COMP%]{position:fixed;inset:0;z-index:10000}.mdc-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]{display:block}.mdc[_ngcontent-%COMP%]{display:block}.mdc[_ngcontent-%COMP%]   .bb-summary[_ngcontent-%COMP%], .mdc[_ngcontent-%COMP%]   .bb-chip[_ngcontent-%COMP%], .mdc[_ngcontent-%COMP%]   .bb-hint[_ngcontent-%COMP%]{display:none!important}.summary.clean[_ngcontent-%COMP%]{display:grid;gap:14px}.summary.clean[_ngcontent-%COMP%]   .s-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.summary.clean[_ngcontent-%COMP%]   .s-title[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:700}.summary.clean[_ngcontent-%COMP%]   .s-title[_ngcontent-%COMP%]   .vs[_ngcontent-%COMP%]{margin:0 8px;color:#888;font-weight:600}.summary.clean[_ngcontent-%COMP%]   .s-title[_ngcontent-%COMP%]   .dl[_ngcontent-%COMP%]{font-size:.9rem;opacity:.85;text-decoration:none}.summary.clean[_ngcontent-%COMP%]   .s-title[_ngcontent-%COMP%]   .dl[_ngcontent-%COMP%]:hover{opacity:1;text-decoration:underline}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]{display:grid;gap:10px}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   .pct[_ngcontent-%COMP%]{font-size:1.9rem;font-weight:800;line-height:1}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   .who[_ngcontent-%COMP%]{font-weight:700;margin-top:2px}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{color:#666;font-size:.9rem}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   .pct.p1[_ngcontent-%COMP%]{color:#0b8}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   .pct.p2[_ngcontent-%COMP%]{color:#248}.summary.clean[_ngcontent-%COMP%]   .punch[_ngcontent-%COMP%]   .fav.muted[_ngcontent-%COMP%]{color:#888}.summary.clean[_ngcontent-%COMP%]   .bar-wrap[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:flex;height:10px;border-radius:999px;overflow:hidden;background:#eee}.summary.clean[_ngcontent-%COMP%]   .bar-wrap[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]   .p1[_ngcontent-%COMP%]{background:#0b8}.summary.clean[_ngcontent-%COMP%]   .bar-wrap[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]   .p2[_ngcontent-%COMP%]{background:#248}.summary.clean[_ngcontent-%COMP%]   .bar-wrap[_ngcontent-%COMP%]   .bar-lbls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:6px;font-size:.95rem}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:8px 14px}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .f[_ngcontent-%COMP%]{display:grid;grid-template-columns:96px 1fr;gap:8px;align-items:baseline}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .k[_ngcontent-%COMP%]{color:#666}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v[_ngcontent-%COMP%]{font-weight:600}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v.mono[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v.pos[_ngcontent-%COMP%]{color:#0b8}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v.neg[_ngcontent-%COMP%]{color:#b14}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v.ok[_ngcontent-%COMP%]{color:#0b8}.summary.clean[_ngcontent-%COMP%]   .facts[_ngcontent-%COMP%]   .v.bad[_ngcontent-%COMP%]{color:#444}.summary.clean[_ngcontent-%COMP%]   .cta[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.summary.clean[_ngcontent-%COMP%]   .cta[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #ddd;background:#fafafa}.summary.clean[_ngcontent-%COMP%]   .cta[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background:#f0f0f0}.mdc-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:9999}.mdc[_ngcontent-%COMP%]{width:min(900px,96vw);max-height:90vh;background:#fff;border-radius:12px;box-shadow:0 18px 60px #00000059;display:grid;grid-template-rows:auto auto 1fr;overflow:hidden}.mdc__header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:2;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#fff;border-bottom:1px solid #eee}.mdc__header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.icon-btn[_ngcontent-%COMP%]{border:0;background:transparent;font-size:22px;line-height:1;cursor:pointer;opacity:.7}.icon-btn[_ngcontent-%COMP%]:hover{opacity:1}.tabs[_ngcontent-%COMP%]{position:sticky;top:48px;z-index:1;display:flex;gap:6px;padding:8px 10px;background:#fff;border-bottom:1px solid #eee}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;border:1px solid #ddd;background:#fafafa;border-radius:8px;cursor:pointer}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#e9eefb;border-color:#cdd7f6}.mdc__body[_ngcontent-%COMP%]{overflow:auto;padding:12px 14px 16px}'],changeDetection:0})};function Me(s){return Math.round(s*10)/10}var z=class s{constructor(t){this.http=t}apiUrl=_e.apiUrl;getArchiveDateRange(){return this.http.get(`${this.apiUrl}/archives/daterange`)}getArchiveAvailableDates(){return this.http.get(`${this.apiUrl}/archives/available-dates`)}getMatchesByDate(t){return this.http.get(`${this.apiUrl}/matches/summaries/by-date/${t}`)}getMatchesByDateRange(t,e){return this.http.get(`${this.apiUrl}/matches/filter-by-date-range?from=${t}&to=${e}`)}getDateRange(){return this.http.get(`${this.apiUrl}/matches/daterange`)}getAvailableDates(){return this.http.get(`${this.apiUrl}/matches/available-dates`)}getMatchDetails(t){return this.http.get(`/api/archives/match-details/${t}`)}getTrueSkillHistory(t,e){return console.log(`${this.apiUrl}/trueskill/history?player1TPId=${t}&player2TPId=${e}`),this.http.get(`${this.apiUrl}/trueskill/history?player1TPId=${t}&player2TPId=${e}`)}getMergedTrueSkillHistory(t,e){return console.log(`${this.apiUrl}/trueskill/history/merged?player1TPId=${t}&player2TPId=${e}`),this.http.get(`${this.apiUrl}/trueskill/history/merged?player1TPId=${t}&player2TPId=${e}`)}getDailyMatchesByDate(t){return this.http.get(`${this.apiUrl}/archives/daily/${t}`)}getDailyMatches(t){return this.http.get(`${this.apiUrl}/archives/daily/${t}`).pipe(X(e=>e.matches))}getLatestDailyDate(){return this.http.get(`${this.apiUrl}/archives/latest-daily`)}getDailyArchive(t){return this.http.get(`${this.apiUrl}/archives/daily/${t}`)}static \u0275fac=function(e){return new(e||s)(Z(se))};static \u0275prov=q({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ye=["dateInput"];function Ge(s,t){s&1&&(a(0,"div",21)(1,"div",22),f(2,"div",23),a(3,"p",24),l(4,"Loading..."),r()()())}function Ke(s,t){s&1&&(a(0,"span",25),l(1,"\u25CF"),r())}function Qe(s,t){s&1&&(a(0,"div",26),l(1," No matches found for the selected filters."),f(2,"br"),l(3," Please adjust your filter options or clear the filters to continue browsing. "),r())}function Xe(s,t){if(s&1&&(a(0,"span"),l(1),r()),s&2){let e=u(2);o(),_(e.sortDirection==="asc"?"\u2191":"\u2193")}}function qe(s,t){if(s&1&&(a(0,"span"),l(1),r()),s&2){let e=u(2);o(),_(e.sortDirection==="asc"?"\u2191":"\u2193")}}function Ze(s,t){if(s&1){let e=b();a(0,"tr")(1,"td"),l(2),r(),a(3,"td"),l(4),r(),a(5,"td"),f(6,"span",31),a(7,"span",32),d("click",function(){let i=h(e).$implicit,c=u(2);return g(c.openTournamentModal(i.tournamentEventTPId))}),l(8),r()(),a(9,"td"),l(10),r(),a(11,"td"),l(12),r(),a(13,"td"),f(14,"span",31),a(15,"span",32),d("click",function(){let i=h(e).$implicit,c=u(2);return g(c.openPlayerModal(i.player1TPId))}),l(16),r()(),a(17,"td"),f(18,"span",31),a(19,"span",32),d("click",function(){let i=h(e).$implicit,c=u(2);return g(c.openPlayerModal(i.player2TPId))}),l(20),r()(),a(21,"td"),l(22),r(),a(23,"td"),l(24),r(),f(25,"td",33)(26,"td",34),a(27,"td")(28,"small",28),d("click",function(){let i=h(e).$implicit,c=u(2);return g(c.openMatchModal(i))}),l(29,"Details"),r()()()}if(s&2){let e=t.$implicit,n=u(2);o(2),_(n.getLocalizedDateTime(e.dateTime)),o(2),_(e.tournamentTypeName),o(2),V("fi fi-",n.flagCode(e.tournamentEventCountryISO2).toLowerCase(),""),m("title",e.tournamentEventCountryISO2||"World"),o(2),y(" ",n.cleanTournamentNameFront(n.decodeHtmlEntities(e.tournamentEventName||""))," "),o(2),_(e.tournamentLevelName),o(2),_(e.surface),o(2),V("fi fi-",n.flagCode(e.player1CountryISO2).toLowerCase(),""),m("title",e.player1CountryISO2||"World"),o(2),y(" ",e.player1Label||n.decodeHtmlEntities(e.player1Name||"")," "),o(2),V("fi fi-",n.flagCode(e.player2CountryISO2).toLowerCase(),""),m("title",e.player2CountryISO2||"World"),o(2),y(" ",e.player2Label||n.decodeHtmlEntities(e.player2Name||"")," "),o(2),_(n.formatResult(e.result)),o(2),_(n.formatResultDetails(e.resultDetails)),o(),m("innerHTML",n.formatOddsHTML(e.oddsText),j),o(),m("innerHTML",n.formatProbHTML(e.probabilityText),j)}}function Je(s,t){if(s&1){let e=b();a(0,"table",27)(1,"thead")(2,"tr")(3,"th",28),d("click",function(){h(e);let i=u();return g(i.toggleSort("date"))}),l(4," Date "),v(5,Xe,2,1,"span",29),r(),a(6,"th"),l(7,"Type"),r(),a(8,"th",28),d("click",function(){h(e);let i=u();return g(i.toggleSort("tournament"))}),l(9," Tournament "),v(10,qe,2,1,"span",29),r(),a(11,"th"),l(12,"Level"),r(),a(13,"th"),l(14,"Surface"),r(),a(15,"th"),l(16,"Player 1"),r(),a(17,"th"),l(18,"Player 2"),r(),a(19,"th"),l(20,"Result"),r(),a(21,"th"),l(22,"Result Details"),r(),a(23,"th"),l(24,"Odds"),r(),a(25,"th"),l(26,"Probability"),r(),a(27,"th"),l(28,"Details"),r()()(),a(29,"tbody"),v(30,Ze,30,23,"tr",30),r()()}if(s&2){let e=u();o(5),m("ngIf",e.sortField==="date"),o(5),m("ngIf",e.sortField==="tournament"),o(20),m("ngForOf",e.matches)}}function et(s,t){if(s&1){let e=b();a(0,"app-match-filter-modal",35),d("closed",function(){h(e);let i=u();return g(i.closeFilterModal())})("filterApplied",function(i){h(e);let c=u();return g(c.onFilterApplied(i))})("resetFilter",function(){h(e);let i=u();return g(i.onFilterReset())}),r()}if(s&2){let e=u();m("activeDateFilter",e.activeDateFilter)("activeFromDate",e.activeFromDate)("activeToDate",e.activeToDate)("minDate",e.minDate)("maxDate",e.maxDate)("activeSurfaceIds",e.activeSurfaceIds)("activeTournamentTypeIds",e.activeTournamentTypeIds)("activeTournamentLevelIds",e.activeTournamentLevelIds)}}function tt(s,t){if(s&1){let e=b();a(0,"app-match-details-modal",36),d("closed",function(){h(e);let i=u();return g(i.closeMatchModal())}),r()}if(s&2){let e=u();m("match",e.selectedMatch)}}function nt(s,t){if(s&1){let e=b();a(0,"div",37),d("click",function(){h(e);let i=u();return g(i.closeDateWarningModal())}),a(1,"div",38),d("click",function(i){return h(e),g(i.stopPropagation())}),a(2,"h5",39),l(3,"Date Adjusted"),r()(),a(4,"div",40),d("click",function(i){return h(e),g(i.stopPropagation())}),a(5,"p"),l(6," No matches are available outside the allowed range. "),f(7,"br"),l(8," Allowed date range: "),a(9,"strong"),l(10),x(11,"date"),r(),l(12," to "),a(13,"strong"),l(14),x(15,"date"),r(),l(16,". "),r(),f(17,"hr"),a(18,"div",41)(19,"button",42),d("click",function(){h(e);let i=u();return g(i.closeDateWarningModal())}),l(20,"OK"),r()()()()}if(s&2){let e=u();o(10),_(D(11,2,e.minDate,"yyyy-MM-dd")),o(4),_(D(15,5,e.maxDate,"yyyy-MM-dd"))}}function it(s,t){if(s&1){let e=b();a(0,"div",43)(1,"div",44)(2,"h5",39),l(3,"Invalid Date"),r()(),a(4,"div",45)(5,"p"),l(6," The selected date is outside your active filter range."),f(7,"br"),l(8," Please adjust your filter settings or clear the filter. "),r(),f(9,"hr"),a(10,"div",41)(11,"button",42),d("click",function(){h(e);let i=u();return g(i.showOutOfRangeModal=!1)}),l(12,"OK"),r()()()()}}var ye=class s{constructor(t,e,n){this.matchService=t;this.translate=e;this.appComponent=n}Math=Math;matches=[];filteredMatches=[];isFiltered=!1;filteredPage=1;currentDate=new Date("2022-01-01");isNextDisabled=!1;isPrevDisabled=!1;loading=!1;selectedDate=null;showDatepicker=!1;showFilterModal=!1;selectedPlayer=null;selectedTournament=null;sortField="tournament";sortDirection="asc";filterApplied=!1;activeDateFilter="all";activeFromDate=null;activeToDate=null;activeSurfaceIds=[1,2,3,4];activeTournamentTypeIds=[2,4];activeTournamentLevelIds=[1,2,3,4];filteredAvailableDates=[];showDateWarning=!1;currentDateString="";noMatchesForFilter=!1;showOutOfRangeModal=!1;minDate;maxDate;inputDebounceTimeout=null;availableDates=[];selectedMatch=null;escHandler=t=>this.handleEscapeKey(t);dateInputRef;onClickOutside(t){let e=t.target,n=e.closest(".datepicker-wrapper"),i=e.closest(".datepicker-toggle");!n&&!i&&(this.showDatepicker=!1)}flagCode(t){let e=(t||"").toUpperCase().trim();return!e||e==="WD"||e==="WLD"||e==="XX"||e==="XW"||e==="-"?"UN":e==="UK"?"GB":e}ymdLocal(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}ymdCompact(t){return this.ymdLocal(t).replace(/-/g,"")}daySourceMatches=[];static SURFACE_MAP={indoors:1,indoor:1,clay:2,grass:3,hard:4};static TYPE_MAP={ATP:2,WTA:4};static LEVEL_MAP={"> 50,000$":1,Cup:2,Qualifications:3,"< 50,000$":4};ngOnInit(){document.addEventListener("keydown",this.escHandler),this.loading=!0,this.matchService.getArchiveDateRange().subscribe({next:({minDate:t,maxDate:e})=>{if(!t||!e){this.matches=[],this.loading=!1;return}this.minDate=new Date(t),this.maxDate=new Date(e),this.currentDate=this.maxDate,this.currentDateString=this.ymdLocal(this.currentDate),this.matchService.getArchiveAvailableDates().subscribe({next:n=>{this.availableDates=n,this.loadMatchesForDate(this.currentDate),this.loading=!1},error:n=>{console.error("\u274C Failed to load available archive dates:",n),this.loading=!1}})},error:t=>{console.error("\u274C Failed to load archive date range:",t),this.loading=!1}})}ngOnDestroy(){document.removeEventListener("keydown",this.escHandler)}formatDate(t){return this.ymdCompact(t)}scrollToTop(){let t=document.querySelector(".table-wrapper");t&&(t.scrollTop=0)}handleEscapeKey(t){t.key==="Escape"&&(this.closeDateWarningModal?.(),this.selectedMatch&&this.closeMatchModal())}loadMatchesForDate(t){this.loading=!0;let e=this.correctDateIfOutOfBounds(t);this.currentDate=e,this.currentDateString=this.ymdLocal(e),this.noMatchesForFilter=!1,e.getTime()!==t.getTime()&&this.showDateOutOfRangeModal();let n=this.formatDate(e);this.matchService.getDailyMatches(n).subscribe({next:i=>{let c=i||[];this.daySourceMatches=c,this.matches=this.isFiltered?this.filterMatchesByActiveFilters(this.daySourceMatches):this.daySourceMatches,this.sortMatches(),this.checkAdjacentDaysAvailability(e),this.noMatchesForFilter=this.isFiltered&&this.matches.length===0,this.loading=!1},error:i=>{console.error("\u274C Error loading matches:",i),this.matches=[],this.loading=!1,this.isPrevDisabled=!0,this.isNextDisabled=!0}})}sortMatches(){this.matches.sort((t,e)=>{let n="",i="";this.sortField==="tournament"?(n=this.removeRomanSuffix(t.tournamentEventName||"").toLowerCase(),i=this.removeRomanSuffix(e.tournamentEventName||"").toLowerCase()):this.sortField==="date"&&(n=new Date(t.dateTime).getTime(),i=new Date(e.dateTime).getTime());let c=n<i?-1:n>i?1:0;return this.sortDirection==="asc"?c:-c})}toggleSort(t){this.sortField===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=t,this.sortDirection="asc"),this.sortMatches(),this.applyActiveFiltersToCurrentDay()}onNativeDateChange(t){let e=t.target,n=new Date(e.value);if(isNaN(n.getTime()))return;let i=n.toISOString().split("T")[0];if(this.isFiltered&&this.filteredAvailableDates.length>0&&!this.filteredAvailableDates.includes(i)){this.showOutOfFilterRangeModal();let p=this.currentDate?this.formatDateForInput(this.currentDate):"";console.log("Resetting input to last valid date:",this.currentDate,p),this.currentDateString=p,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=this.currentDateString);return}this.loadMatchesForDate(n)}onDateInputChanged(t){let e=t.target;this.inputDebounceTimeout&&clearTimeout(this.inputDebounceTimeout),this.inputDebounceTimeout=setTimeout(()=>{let n=new Date(e.value);if(isNaN(n.getTime()))return;let i=n.toISOString().split("T")[0];if(this.isFiltered&&this.filteredAvailableDates.length>0&&!this.filteredAvailableDates.includes(i)){this.showOutOfFilterRangeModal();let p=this.ymdLocal(this.currentDate);this.currentDateString=p,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=p);return}if(!this.isFiltered){let c=this.correctDateIfOutOfBounds(n);if(c.getTime()!==n.getTime()){this.showDateOutOfRangeModal();let p=this.ymdLocal(c);this.currentDate=c,this.currentDateString=p,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=p),this.loadMatchesForDate(c),this.checkAdjacentDaysAvailability(c);return}}this.loadMatchesForDate(n)},500)}previousDay(){let t=this.isFiltered&&this.filteredAvailableDates.length>0?this.filteredAvailableDates:this.availableDates,e=this.ymdLocal(this.currentDate),n=t.findIndex(i=>i.trim()===e);if(n>0){let i=new Date(t[n-1].trim());this.currentDate=i,this.currentDateString=this.ymdLocal(i),this.filteredPage=1,this.loadMatchesForDate(i)}this.scrollToTop()}nextDay(){let t=this.isFiltered&&this.filteredAvailableDates.length>0?this.filteredAvailableDates:this.availableDates,e=this.ymdLocal(this.currentDate),n=t.findIndex(i=>i.trim()===e);if(n>=0&&n<t.length-1){let i=new Date(t[n+1].trim());this.currentDate=i,this.currentDateString=this.ymdLocal(i),this.filteredPage=1,this.loadMatchesForDate(i)}this.scrollToTop()}getLocalizedDateTime(t){let e=typeof t=="string"?new Date(t):t;if(isNaN(e.getTime()))return"";let n=T=>T.toString().padStart(2,"0"),i=n(e.getDate()),c=n(e.getMonth()+1),p=e.getFullYear(),M=n(e.getHours()),I=n(e.getMinutes());return`${i}.${c}.${p} ${M}:${I}`}formatOdds(t){return t==null||isNaN(t)?"":t.toFixed(2)}formatPercent(t){return t==null||isNaN(t)?"":(t*100).toFixed(0)+"%"}openMatchModal(t){this.selectedMatch=t}closeMatchModal(){this.selectedMatch=null}openFilterModal(){this.showFilterModal=!0}closeFilterModal(){this.showFilterModal=!1}openPlayerModal(t){this.selectedPlayer=t}closePlayerModal(){this.selectedPlayer=null}openTournamentModal(t){this.selectedTournament=t}closeTournamentModal(){this.selectedTournament=null}formatResult(t){if(t==null)return"";let e=String(t).trim();if(!e)return"";if(e.includes(":")||/^(RET|W[OW]|ABD|CAN|DEF)$/i.test(e))return e;let n=e.match(/^(\d{1,2})\D?(\d{1,2})$/);return n?`${parseInt(n[1],10)}:${parseInt(n[2],10)}`:e}formatResultDetails(t){return t?t.split(/\s+/).filter(Boolean).map(e=>{if(e.includes(":"))return e;let n=e.match(/^(\d{1,2})(\d{1,2})(\([^)]+\))?$/);if(n)return`${parseInt(n[1],10)}:${parseInt(n[2],10)}${n[3]||""}`;let i=e.match(/^(\d{1,2})[-–](\d{1,2})$/);return i?`${parseInt(i[1],10)}:${parseInt(i[2],10)}`:e}).join(" "):""}removeRomanSuffix(t){return t.replace(/\s*(\([IVXLCDM]{1,4}\)|[IVXLCDM]{1,4})\s*$/,"").trim()}decodeHtmlEntities(t){let e=document.createElement("textarea");return e.innerHTML=t,e.value}onFilterApplied(t){console.log("\u{1F9EA} onFilterApplied (incoming):",t),this.activeDateFilter=t.option,this.activeFromDate=t.startDate,this.activeToDate=t.endDate,this.activeSurfaceIds=(t.surfaceIds||[]).map(Number),this.activeTournamentTypeIds=(t.tournamentTypeIds||[]).map(Number),this.activeTournamentLevelIds=(t.tournamentLevelIds||[]).map(Number);let e=[1,2,3,4],n=[2,4],i=[1,2,3,4],c=t.option==="all",p=this.activeSurfaceIds.length===e.length&&e.every(T=>this.activeSurfaceIds.includes(T)),M=this.activeTournamentTypeIds.length===n.length&&n.every(T=>this.activeTournamentTypeIds.includes(T)),I=this.activeTournamentLevelIds.length===i.length&&i.every(T=>this.activeTournamentLevelIds.includes(T));this.isFiltered=!(c&&p&&M&&I),this.filterApplied=this.isFiltered,this.matches=this.isFiltered?this.filterMatchesByActiveFilters(this.daySourceMatches):this.daySourceMatches,this.sortMatches(),this.noMatchesForFilter=this.isFiltered&&this.matches.length===0,this.filteredPage=1,this.showFilterModal=!1}normalizeSurfaceId(t){let e=t.surfaceId??t.surface_id??null;if(e!=null&&!Number.isNaN(+e))return+e;let n=t.surface??t.courtSurface??t.surfaceName;if(n){let i=String(n).toLowerCase().trim();return s.SURFACE_MAP[i]??null}return null}normalizeTypeId(t){let e=t.tournamentTypeId??t.typeId??null;if(e!=null&&!Number.isNaN(+e))return+e;let n=t.tournamentType??t.series??t.tour??t.category;if(n){let i=String(n).toUpperCase().trim();return s.TYPE_MAP[i]??null}return null}normalizeLevelId(t){let e=t.tournamentLevelId??t.levelId??null;if(e!=null&&!Number.isNaN(+e))return+e;let n=t.tournamentLevel??t.level??t.eventLevel;if(n){let i=String(n).trim();return s.LEVEL_MAP[i]??null}return null}filterMatchesByActiveFilters(t){if(!this.isFiltered)return t||[];let e=new Set((this.activeSurfaceIds||[]).map(Number)),n=new Set((this.activeTournamentTypeIds||[]).map(Number)),i=new Set((this.activeTournamentLevelIds||[]).map(Number));return(t||[]).filter(c=>{if(e.size>0){let p=this.normalizeSurfaceId(c);if(p==null||!e.has(p))return!1}if(n.size>0){let p=this.normalizeTypeId(c);if(p==null||!n.has(p))return!1}if(i.size>0){let p=this.normalizeLevelId(c);if(p==null||!i.has(p))return!1}return!0})}applyActiveFiltersToCurrentDay(){this.filteredMatches=this.filterMatchesByActiveFilters(this.matches),this.noMatchesForFilter=this.isFiltered&&this.filteredMatches.length===0}generateDateRange(t,e){let n=[],i=new Date(t),c=new Date(e);for(;i<=c;){let p=i.toISOString().split("T")[0];this.availableDates.includes(p)&&n.push(p),i.setDate(i.getDate()+1)}return n}clearFilter(){this.isFiltered=!1,this.filterApplied=!1,this.matches=this.daySourceMatches,this.sortMatches(),this.filteredPage=1,this.noMatchesForFilter=!1}onFilterReset(){this.filterApplied=!1,this.activeDateFilter="all",this.activeFromDate=null,this.activeToDate=null,this.clearFilter()}isFilterDefault(){let t=this.activeSurfaceIds.length===4&&[1,2,3,4].every(c=>this.activeSurfaceIds.includes(c)),e=this.activeTournamentTypeIds.length===2&&[2,4].every(c=>this.activeTournamentTypeIds.includes(c)),n=this.activeTournamentLevelIds.length===4&&[1,2,3,4].every(c=>this.activeTournamentLevelIds.includes(c)),i=this.activeDateFilter==="all";return t&&e&&n&&i}correctDateIfOutOfBounds(t){return t<this.minDate?this.minDate:t>this.maxDate?this.maxDate:t}showDateOutOfRangeModal(){this.showDateWarning=!0,setTimeout(()=>this.closeDateWarningModal(),5e3)}closeDateWarningModal(){this.showDateWarning=!1}checkAdjacentDaysAvailability(t){let e=this.ymdLocal(t),n=this.isFiltered&&this.filteredAvailableDates.length>0?this.filteredAvailableDates.map(c=>c.trim()):this.availableDates.map(c=>c.trim()),i=n.indexOf(e);this.isPrevDisabled=i<=0,this.isNextDisabled=i===-1||i>=n.length-1}showOutOfFilterRangeModal(){this.showOutOfRangeModal=!0,setTimeout(()=>this.showOutOfRangeModal=!1,5e3)}formatDateForInput(t){return!t||isNaN(t.getTime())?(console.error("\u274C Invalid date passed to formatDateForInput:",t),"Invalid-Date"):this.ymdLocal(t)}cleanTournamentNameFront(t){if(!t)return"";let e=t.replace(/\s*(?:\([^()]*\)\s*)+$/g,"");return e=e.replace(/\s*(?:[IVXLCDM]{1,4})\s*$/i,""),e.replace(/\s{2,}/g," ").trim()}leftOf(t){return this.splitPair(t)[0]}rightOf(t){return this.splitPair(t)[1]}hasBoth(t){let[e,n]=this.splitPair(t);return!!(e&&n)}alignFixed(t,e,n){let i=Number(String(t).replace(",","."));if(!Number.isFinite(i))return"";let[c,p=""]=i.toFixed(n).split("."),M=c,I=Math.max(0,e-M.length);return"\u2007".repeat(I)+M+"."+p}splitPair(t){if(!t)return["",""];let e=t.includes("\u2013")?t.split("\u2013"):t.split("-");return[(e[0]||"").trim(),(e[1]||"").trim()]}toFixedParts(t,e=2){let n=Number(String(t).replace(",","."));if(!Number.isFinite(n))return["",""];let i=n.toFixed(e),[c,p=""]=i.split(".");return[c,p]}ghostPadInt(t,e){let n=Math.max(0,e-t.length);return n?`<span class="ghost">${"0".repeat(n)}</span>${t}`:t}formatOddsHTML(t){let[e,n]=this.splitPair(t),[i,c]=this.toFixedParts(e,2),[p,M]=this.toFixedParts(n,2);if(i==="0"&&c==="00"&&p==="0"&&M==="00")return"";let T=`${this.ghostPadInt(i,2)}.${c}`,xe=`${this.ghostPadInt(p,2)}.${M}`;return`<span class="dual dual-odds"><span class="l">${T}</span><span class="mid">\u2013</span><span class="r">${xe}</span></span>`}formatProbHTML(t){let[e,n]=this.splitPair(t),[i,c]=this.toFixedParts(e,2),[p,M]=this.toFixedParts(n,2),I=`${this.ghostPadInt(i,3)}.${c}`,T=`${this.ghostPadInt(p,3)}.${M}`;return`<span class="dual dual-prob"><span class="l">${I}</span><span class="mid">\u2013</span><span class="r">${T}</span></span>`}static \u0275fac=function(e){return new(e||s)(L(z),L(pe),L(fe))};static \u0275cmp=O({type:s,selectors:[["app-matches"]],viewQuery:function(e,n){if(e&1&&ie(Ye,5),e&2){let i;ae(i=re())&&(n.dateInputRef=i.first)}},hostBindings:function(e,n){e&1&&d("click",function(c){return n.onClickOutside(c)},!1,te)},inputs:{minDate:"minDate",maxDate:"maxDate"},decls:23,vars:12,consts:[["dateInput",""],[1,"matches-page-wrapper","main-scroll"],["class","loading-overlay",4,"ngIf"],[1,"date-nav-sticky"],[1,"date-left"],[1,"pagination-center-wrapper"],[1,"link-button",3,"click","disabled"],["src","assets/icons/left.svg","alt","Previous",1,"arrow-icon"],["type","date",1,"custom-date-input",3,"change","value","disabled"],["src","assets/icons/right.svg","alt","Next",1,"arrow-icon"],[1,"date-right"],[1,"link-button",3,"click"],["src","assets/icons/filter.svg","alt","Filter",1,"icon","icon-filter"],["class","badge-on",4,"ngIf"],[1,"table-wrapper"],["class","text-center mt-3 p-3 rounded border","style","background-color: #f8f9fa; color: #6c757d;",4,"ngIf"],["class","match-table",4,"ngIf"],[3,"activeDateFilter","activeFromDate","activeToDate","minDate","maxDate","activeSurfaceIds","activeTournamentTypeIds","activeTournamentLevelIds","closed","filterApplied","resetFilter",4,"ngIf"],[3,"match","closed",4,"ngIf"],["class","modal-custom",3,"click",4,"ngIf"],["class","modal-custom",4,"ngIf"],[1,"loading-overlay"],[1,"spinner-wrapper"],["role","status",1,"spinner-border","text-light"],[1,"text-white","mt-3"],[1,"badge-on"],[1,"text-center","mt-3","p-3","rounded","border",2,"background-color","#f8f9fa","color","#6c757d"],[1,"match-table"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"title"],[1,"clickable-text",3,"click"],[1,"odds-combined-cell",3,"innerHTML"],[1,"odds-combined-cell","percentage-cell",3,"innerHTML"],[3,"closed","filterApplied","resetFilter","activeDateFilter","activeFromDate","activeToDate","minDate","maxDate","activeSurfaceIds","activeTournamentTypeIds","activeTournamentLevelIds"],[3,"closed","match"],[1,"modal-custom",3,"click"],[1,"modal-header","justify-content-center",3,"click"],[1,"modal-title","text-center","w-100"],[1,"modal-body",3,"click"],[1,"text-end"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"modal-custom"],[1,"modal-header","justify-content-center"],[1,"modal-body"]],template:function(e,n){if(e&1){let i=b();a(0,"div",1),v(1,Ge,5,0,"div",2),a(2,"div",3),f(3,"div",4),a(4,"div",5)(5,"button",6),d("click",function(){return h(i),g(n.previousDay())}),f(6,"img",7),r(),a(7,"input",8,0),d("change",function(p){return h(i),g(n.onDateInputChanged(p))}),r(),a(9,"button",6),d("click",function(){return h(i),g(n.nextDay())}),f(10,"img",9),r()(),a(11,"div",10)(12,"button",11),d("click",function(){return h(i),g(n.openFilterModal())}),f(13,"img",12),l(14," Filter "),v(15,Ke,2,0,"span",13),r()()(),a(16,"div",14),v(17,Qe,4,0,"div",15)(18,Je,31,3,"table",16)(19,et,1,8,"app-match-filter-modal",17)(20,tt,1,1,"app-match-details-modal",18)(21,nt,21,8,"div",19)(22,it,13,0,"div",20),r()()}e&2&&(o(),m("ngIf",n.loading),o(4),m("disabled",n.isPrevDisabled),o(2),m("value",n.currentDateString)("disabled",n.matches.length===0||n.isFiltered&&n.filteredAvailableDates.length===0),o(2),m("disabled",n.isNextDisabled),o(6),m("ngIf",n.isFiltered),o(2),m("ngIf",n.matches.length===0&&n.isFiltered),o(),m("ngIf",n.matches.length>0),o(),m("ngIf",n.showFilterModal),o(),m("ngIf",n.selectedMatch),o(),m("ngIf",n.showDateWarning),o(),m("ngIf",n.showOutOfRangeModal))},dependencies:[P,B,w,F,H,ue,W,U],encapsulation:2})};export{ye as MatchesComponent};

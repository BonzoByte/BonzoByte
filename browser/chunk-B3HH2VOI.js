import{d as E,f as I,j as V,k as G}from"./chunk-FTZJADZT.js";import{a as T,b,c as F,d as L,f as N,h as B,i as j,j as A,l as D}from"./chunk-UL5CEDMN.js";import{a as O,b as q}from"./chunk-4PILAPRA.js";import{a as R,f as z}from"./chunk-3TN6O5IR.js";import{Db as m,Eb as w,Ma as n,Ra as d,Xa as k,ab as u,ec as S,gc as P,hb as l,jb as h,jc as M,ka as _,la as C,nb as i,ob as o,pb as f,sb as y,tb as p,ub as g}from"./chunk-7QM3SHZA.js";function H(s,r){s&1&&(i(0,"p",18),m(1,"Obavezno"),o())}function x(s,r){s&1&&(i(0,"p",18),m(1,"Lozinke se ne podudaraju"),o())}function $(s,r){if(s&1&&(i(0,"p",19),m(1),o()),s&2){let t=g();n(),w(t.successMessage)}}function J(s,r){if(s&1&&(i(0,"p",18),m(1),o()),s&2){let t=g();n(),w(t.errorMessage)}}function K(s,r){if(s&1){let t=y();i(0,"div",14)(1,"button",20),p("accessibleClick",function(){_(t);let a=g();return C(a.goToLogin())}),m(2,"Go to login"),o()()}}var U=class s{constructor(r,t,e,a,c){this.fb=r;this.route=t;this.http=e;this.snack=a;this.router=c;this.form=this.fb.group({password:["",b.required],confirm:["",b.required]},{validators:Q})}form;loading=!1;submitted=!1;token=null;email=null;successMessage="";errorMessage="";showPassword=!1;showConfirm=!1;ngOnInit(){document.body.classList.add("modal-open");let r=this.route.snapshot.queryParamMap;if(this.token=r.get("token"),this.email=r.get("email"),!this.token||!this.email){let t=new URLSearchParams(window.location.search||"");this.token=this.token||t.get("token"),this.email=this.email||t.get("email")}if(!this.token||!this.email){let t=(window.location.hash||"").replace(/^#/,"");if(t){let e=new URLSearchParams(t.includes("?")?t.slice(t.indexOf("?")+1):t);this.token=this.token||e.get("token"),this.email=this.email||e.get("email")}}this.token||(this.token=sessionStorage.getItem("BB_reset_token")),this.email||(this.email=sessionStorage.getItem("BB_reset_email")),(!this.token||!this.email)&&(this.errorMessage="Missing token or email.")}ngOnDestroy(){document.body.classList.remove("modal-open")}onSubmit(){if(this.submitted=!0,this.form.invalid||!this.token||!this.email)return;this.loading=!0;let{password:r}=this.form.value;this.http.post(`${z.apiUrl}/auth/reset-password`,{token:this.token,email:this.email,password:r}).subscribe({next:t=>{this.successMessage=t?.message||"Lozinka uspje\u0161no promijenjena.",this.errorMessage="",this.snack.open(this.successMessage,"",{duration:3e3})},error:t=>{this.errorMessage=t?.error?.message||"Gre\u0161ka pri promjeni lozinke.",this.successMessage="",this.snack.open(this.errorMessage,"",{duration:4e3})},complete:()=>this.loading=!1})}goToLogin(){document.body.classList.remove("modal-open"),this.router.navigateByUrl("/").then(()=>{window.dispatchEvent(new CustomEvent("openLogin"))})}static \u0275fac=function(t){return new(t||s)(d(A),d(E),d(R),d(V),d(I))};static \u0275cmp=k({type:s,selectors:[["app-reset-password"]],decls:29,vars:16,consts:[["appAccessibleClick","","aria-hidden","true",1,"bb-backdrop",3,"accessibleClick"],["role","dialog","aria-modal","true","aria-labelledby","reset-title","appTrapFocus","",1,"bb-modal",3,"click","onEscape"],["appAccessibleClick","","aria-label","Close",1,"close-button",3,"accessibleClick"],["id","reset-title"],[3,"ngSubmit","formGroup"],[1,"form-row"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","New password",1,"password-input",3,"type"],["type","button","appAccessibleClick","","aria-label","Toggle password visibility",1,"toggle-password",3,"accessibleClick"],[1,"bi",3,"ngClass"],["class","error",4,"ngIf"],["for","confirm"],["id","confirm","formControlName","confirm","placeholder","Confirm password",1,"password-input",3,"type"],[1,"text-center"],["type","submit",3,"disabled"],["class","success",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"error"],[1,"success"],["type","button","appAccessibleClick","",1,"link-button",3,"accessibleClick"]],template:function(t,e){if(t&1&&(i(0,"div",0),p("accessibleClick",function(){return e.goToLogin()}),i(1,"div",1),p("click",function(c){return c.stopPropagation()}),i(2,"button",2),p("accessibleClick",function(){return e.goToLogin()}),m(3,"\uFFFD"),o(),i(4,"h4",3),m(5,"Reset Password"),o(),i(6,"form",4),p("ngSubmit",function(){return e.onSubmit()}),i(7,"div",5)(8,"label",6),m(9,"New Password:"),o(),i(10,"div",7),f(11,"input",8),i(12,"button",9),p("accessibleClick",function(){return e.showPassword=!e.showPassword}),f(13,"i",10),o()(),u(14,H,2,0,"p",11),o(),i(15,"div",5)(16,"label",12),m(17,"Confirm Password:"),o(),i(18,"div",7),f(19,"input",13),i(20,"button",9),p("accessibleClick",function(){return e.showConfirm=!e.showConfirm}),f(21,"i",10),o()(),u(22,x,2,0,"p",11),o(),i(23,"div",14)(24,"button",15),m(25,"Resetiraj lozinku"),o()(),u(26,$,2,1,"p",16)(27,J,2,1,"p",11),o(),u(28,K,3,0,"div",17),o()()),t&2){let a,c,v;n(),l("onEscape",e.goToLogin),n(5),l("formGroup",e.form),n(5),h("invalid",((a=e.form.get("password"))==null?null:a.invalid)&&(((a=e.form.get("password"))==null?null:a.touched)||e.submitted)),l("type",e.showPassword?"text":"password"),n(2),l("ngClass",e.showPassword?"bi-eye-slash":"bi-eye"),n(),l("ngIf",((c=e.form.get("password"))==null?null:c.hasError("required"))&&(((c=e.form.get("password"))==null?null:c.touched)||e.submitted)),n(5),h("invalid",(((v=e.form.get("confirm"))==null?null:v.touched)||e.submitted)&&!!(e.form.errors!=null&&e.form.errors.passwordsMismatch)),l("type",e.showConfirm?"text":"password"),n(2),l("ngClass",e.showConfirm?"bi-eye-slash":"bi-eye"),n(),l("ngIf",(e.form.errors==null?null:e.form.errors.passwordsMismatch)&&(e.form.touched||e.submitted)),n(2),l("disabled",e.form.invalid||e.loading),n(2),l("ngIf",e.successMessage),n(),l("ngIf",e.errorMessage),n(),l("ngIf",e.successMessage)}},dependencies:[M,S,P,D,N,T,F,L,B,j,G,O,q],encapsulation:2})};function Q(s){let r=s.get("password")?.value,t=s.get("confirm")?.value;return r&&t&&r===t?null:{passwordsMismatch:!0}}export{U as a};
